<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ghost Session Detector</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }

        input, select {
            width: 250px;
            margin-bottom: 10px;
            padding: 5px;
        }

        button {
            padding: 8px 16px;
            margin-top: 10px;
        }

        #result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>Ghost Session Detector</h1>

    <form id="sessionForm">
        <label>User ID:</label><br>
        <input type="text" name="user_id" required><br>

        <label>Device OS:</label><br>
        <select name="device_os" required>
            <option value="Windows">Windows</option>
            <option value="macOS">macOS</option>
            <option value="Linux">Linux</option>
        </select><br>

        <label>Login Hour (e.g. 14.0):</label><br>
        <input type="number" step="0.01" name="login_hour" value="0"><br>

        <label>Typing Speed CPM:</label><br>
        <input type="number" step="0.01" name="typing_speed_cpm" value="0"><br>

        <label>Nav Path:</label><br>
        <select name="nav_path" required>
            <option value="home>dashboard">home&gt;dashboard</option>
            <option value="home>settings">home&gt;settings</option>
            <option value="login>home">login&gt;home</option>
        </select><br>

        <label>Nav Path Depth:</label><br>
        <input type="number" step="0.01" name="nav_path_depth" value="0"><br>

        <label>IP Country:</label><br>
        <select name="ip_country" required>
            <option value="US">US</option>
            <option value="MY">MY</option>
            <option value="SG">SG</option>
            <option value="UK">UK</option>
        </select><br>

        <label>Session Duration (sec):</label><br>
        <input type="number" step="0.01" name="session_duration_sec" value="0"><br>

        <label>Mouse Movement Rate:</label><br>
        <input type="number" step="0.01" name="mouse_movement_rate" value="0"><br>

        <label>Device ID:</label><br>
        <select name="device_id" required>
            <option value="device_A">device_A</option>
            <option value="device_B">device_B</option>
            <option value="device_C">device_C</option>
        </select><br>

        <label>IP Consistency Score:</label><br>
        <input type="number" step="0.01" name="ip_consistency_score" value="0"><br>

        <label>Login Day of Week:</label><br>
        <select name="login_day_of_week" required>
            <option value="1">Monday</option>
            <option value="2">Tuesday</option>
            <option value="3">Wednesday</option>
            <option value="4">Thursday</option>
            <option value="5">Friday</option>
            <option value="6">Saturday</option>
            <option value="7">Sunday</option>
        </select><br>

        <label>Geo Distance from Usual:</label><br>
        <input type="number" step="0.01" name="geo_distance_from_usual" value="0"><br>

        <label>Browser Language:</label><br>
        <select name="browser_language" required>
            <option value="en-US">en-US</option>
            <option value="en-GB">en-GB</option>
            <option value="ms-MY">ms-MY</option>
        </select><br>

        <label>Failed Login Attempts (Last 24h):</label><br>
        <input type="number" name="failed_login_attempts_last_24h" value="0"><br>

        <label>Is VPN Detected?</label><br>
        <label><input type="radio" name="is_vpn_detected" value="1"> Yes</label>
        <label><input type="radio" name="is_vpn_detected" value="0" checked> No</label><br>

        <label>Recent Device Change?</label><br>
        <label><input type="radio" name="recent_device_change" value="1"> Yes</label>
        <label><input type="radio" name="recent_device_change" value="0" checked> No</label><br>

        <button type="submit">Predict Risk</button>
    </form>

    <div id="result"></div>

    <script>
        const form = document.getElementById("sessionForm");
        const resultDiv = document.getElementById("result");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const session = {};
            const numericFields = [
                "login_hour",
                "typing_speed_cpm",
                "nav_path_depth",
                "session_duration_sec",
                "mouse_movement_rate",
                "ip_consistency_score",
                "geo_distance_from_usual",
                "failed_login_attempts_last_24h",
                "is_vpn_detected",
                "recent_device_change"
            ];

            formData.forEach((value, key) => {
                if (numericFields.includes(key)) {
                    session[key] = value.trim() === "" ? 0 : Number(value);
                } else {
                    session[key] = value.trim();
                }
            });

            const payload = { sessions: [session] };

            try {
                const response = await fetch("http://localhost:8000/predict", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                const data = await response.json();
                if (!response.ok) throw new Error(data.detail || "Prediction failed");

                const res = data.results[0];
                resultDiv.innerHTML = `
                    <strong>Score:</strong> ${res.score.toFixed(4)}<br>
                    <strong>Risk Level:</strong> ${res.risk_level}<br>
                    <strong>Predicted Label:</strong> ${res.predicted_label}
                `;
            } catch (error) {
                resultDiv.innerHTML = `<span style="color:red;">Error: ${error.message}</span>`;
            }
        });
    </script>
</body>
</html>